<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="NousGPT RAG Lab - Sistema de entrenamiento sem치ntico con ChromaDB + Ollama y buscador RAG funcional.">
  <title>NousGPT RAG Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <noscript><style>body::after{content:'Activa JavaScript para usar NousGPT RAG Lab.';display:block;padding:2rem;text-align:center;}</style></noscript>
</head>
<body>
  <main class="shell">
    <header class="header panel">
      <div class="header-left">
        <h1>NousGPT 췅 RAG Lab</h1>
        <p>Entrenamiento sem치ntico con ChromaDB + Ollama y buscador RAG con fuentes.</p>
      </div>
      <div class="header-right">
        <div class="status" id="statusBadge">Comprobando...</div>
        <div class="status ollama-status" id="ollamaBadge">Ollama: ...</div>
        <button id="darkModeBtn" class="icon-btn" title="Alternar modo oscuro">游깹</button>
      </div>
    </header>

    <!-- Corpus info -->
    <section class="panel corpus-bar" id="corpusBar">
      <strong>Corpus:</strong> <span id="corpusInfo">cargando...</span>
    </section>

    <section class="grid">
      <!-- Entrenamiento -->
      <article class="panel card">
        <h2>Entrenamiento</h2>
        <label>Colecci칩n
          <input id="collection" value="{{ default_collection }}">
        </label>
        <label>Ruta del corpus
          <input id="corpusDir" value="{{ default_corpus }}">
        </label>
        <div class="row">
          <label>Chunk size
            <input id="chunkSize" type="number" value="{{ default_chunk_size }}">
          </label>
          <label>Overlap
            <input id="overlap" type="number" value="{{ default_overlap }}">
          </label>
        </div>
        <label>Modelo embedding (Ollama)
          <input id="embedModel" value="{{ default_embed_model }}">
        </label>
        <label class="check">
          <input id="resetCollection" type="checkbox" checked>
          Reiniciar colecci칩n antes de entrenar
        </label>
        <button id="trainBtn">Entrenar base vectorial</button>
        <pre id="trainResult" class="result"></pre>
      </article>

      <!-- B칰squeda sem치ntica -->
      <article class="panel card">
        <h2>B칰squeda sem치ntica</h2>
        <label>Consulta
          <textarea id="searchQuery" rows="3" placeholder="Ej: transacciones ACID y rollback"></textarea>
        </label>
        <label>Top K
          <input id="topK" type="number" value="{{ default_top_k }}" min="1" max="20">
        </label>
        <button id="searchBtn">Buscar contexto</button>
        <div id="searchResults" class="list"></div>
      </article>

      <!-- Pregunta RAG -->
      <article class="panel card full">
        <h2>Pregunta RAG (respuesta con fuentes)</h2>
        <div class="row">
          <label>Modelo chat (Ollama)
            <input id="chatModel" value="{{ default_chat_model }}">
          </label>
        </div>
        <label>Pregunta
          <textarea id="askQuery" rows="4" placeholder="Ej: expl칤camelo con ejemplo de c칩digo JDBC o PDO"></textarea>
        </label>
        <button id="askBtn">Responder con RAG</button>
        <article id="answerBox" class="answer hidden">
          <div id="answerContent" class="answer-content"></div>
          <div id="answerSources" class="answer-sources"></div>
        </article>
      </article>
    </section>

    <footer class="footer">NousGPT RAG Lab 췅 ChromaDB + Ollama 췅 DAM2 2025/26</footer>
  </main>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
